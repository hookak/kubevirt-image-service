stages:
- static-check
- build
- e2e
- deploy

# static check stage
lint:
  stage: static-check
  script: ./tbox lint
unit:
  stage: static-check
  script: ./tbox unit
codegen:
  stage: static-check
  script: ./tbox codegen

# build stage
build:
  stage: build
  script: ./tbox build

# e2e stage
e2e:
  stage: e2e
  script:
  - ./tbox minikube
  - ./tbox e2e
  after_script:
  - ./tbox minikube_clean

# deploy stage
# TODO: release branch
deploy-latest:
  stage: deploy
  only:
    refs:
    - master
  script: docker push quay.io/woohhan/kubevirt-image-service
